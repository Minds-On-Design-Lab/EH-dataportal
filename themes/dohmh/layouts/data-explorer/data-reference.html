{{- define "main" -}}

<article class="container-fluid" id="skip-header-target">
    <div class="col-md-11 col-sm-12 mx-auto my-4">
        
        <div class="row no-gutters mb-2">
            <div class="col">
                <nav aria-label="breadcrumb" class="my-3">
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ .Site.BaseURL }}data-explorer/">Data Explorer</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ .Title }}</li>
                    </ul>
                </nav>
            </div>
        </div>
        
        <h1><i class="fas fa-chart-line" aria-hidden="true" style="margin-right: 10px"></i>{{ .Title }}</h1>
        {{- .Content -}}

        <!-- Generate JSON object with topic pages and keys, and internal_ids in arrays -->

        {{- $topic_indicators_dict := newScratch -}}
        {{- $topic_indicators_map := newScratch -}}
        
        {{/*  create a slice for an array of all internal_ids  */}}

        {{- $all_indicator_ids := slice -}}
        
        {{/*  iterate over all pages on the site  */}}

        {{- range .Site.Pages -}}
            
            {{/*  create a new "slice" (i.e., an array)  */}}
            
            {{- $indicators := slice -}}
            {{- $topic_name := slice -}}
            
            {{/*  only process if it's a data explorer page */}}
            
            {{- if (and (eq .Kind "page") (hasPrefix .RelPermalink "/data-explorer") (ne (path.Base .RelPermalink) "all-data")) -}}
                
                {{/*  turn params into strings  */}}
                
                {{- $topic := .RelPermalink | path.Base | string -}}

                {{/*  topic names  */}}
                
                {{- $topic_title := .Title -}}

                {{/*  get internal_ids  */}}
                
                {{- range .Params.indicators -}}
                    
                    {{/*  create an array of internal_ids  */}}
                    
                    {{- $indicators = $indicators | append .IndicatorID -}}

                {{- end -}}
                
                {{/*  create a map with topic as key and array of internal_ids as value */}}
                
                {{- $topic_indicators_dict := dict "topic_name" $topic_title "IndicatorID" $indicators -}}
                {{- $topic_indicators_map.SetInMap "topic_indicators" $topic ($topic_indicators_dict) -}}

            {{- end -}}

            {{- $all_indicator_ids = $all_indicator_ids | append $indicators -}}
            
        {{- end -}}

        {{-  $all_unique_indicator_ids := $all_indicator_ids | uniq | sort  -}}

        {{/*  {{-  warnf "all_unique_indicator_ids >>>> " $all_unique_indicator_ids  -}}  */}}
        
        {{- $all_unique_indicator_ids_json := $all_unique_indicator_ids | jsonify | resources.FromString "/IndicatorData/all_unique_indicator_ids.json" -}}
        
        {{-  warnf ">>>> all_unique_indicator_ids_json.RelPermalink >>>> " $all_unique_indicator_ids_json.RelPermalink  -}}
        
        <p class="sr-only">This produces a list of topics and IndicatorIDs, stored in the variable <code>$topic_indicators</code>, 
            and printed to the console as a JavaScript variable, and then as an Arquero table.</p>
            
            <script>

                var topic_indicators = {{ $topic_indicators_map.Get "topic_indicators" }};
  
            </script>
            
            <p class="sr-only">Also outputting a JSON version of the list to <code><a href="{{ .Site.BaseURL }}IndicatorData/topic_indicators.json">/IndicatorData/topic_indicators.json</code></a> 
                (which on build will be put into <code>/docs/IndicatorData/</code>)</strong>
                
                {{- $si_json_output_path := "/IndicatorData/topic_indicators.json" -}}
                {{- $si_resource := $topic_indicators_map.Get "topic_indicators" | jsonify (dict "indent" "  ") | resources.FromString $si_json_output_path -}}
                



                <div class="row">
                    <div class="col-md-6">
                        {{partial "de-text-search" . }}
                    </div>

                    <div class="col-md-6 border-top">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <th scope="row"><span class="home-label">Name</span></th>
                                    <th id="indName">Indicator Name</th>
                                </tr>
                                <tr>
                                    <th scope="row"><span class="home-label">ID</span></th>
                                    <th id="indID">Ind ID</th>
                                </tr>
                                <tr>
                                    <th scope="row"><span class="home-label">Description</span></th>
                                    <th id="indDesc">Lorem ipsum dolor pasquale</th>
                                </tr>
                                <tr>
                                    <th scope="row"><span class="home-label">Measures</span></th>
                                    <th>
                                        <ul>
                                            <li>(Measure 0 name), (ID)</li>
                                            <li>(Measure 1 name), (ID)</li>
                                            <li>(Measure 2 name), (ID)</li>
                                        </ul>
                                    </th>
                                </tr>
                                <tr>
                                    <th scope="row"><span class="home-label">Part of:</span></th>
                                    <th>
                                        <ul>
                                            <li>Topic 0</li>
                                            <li>Topic 1</li>
                                            <li>Topic 2</li>
                                        </ul>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>


                


                <hr class="my-2">
                <p><i class="fas fa-exclamation-circle mr-1"></i><em>Can't find what you're looking for?</em> Try these other Health Department resources:
                <ul>
                  <li><a href="https://a816-health.nyc.gov/hdi/epiquery/">EpiQuery</a>: Analyze and visualize NYC health data from surveys, disease reports and vital records by sex, race/ethnicity, age and other stratifications.
                  </li>
                  <li><a href="https://a816-health.nyc.gov/hdi/profiles/">Community Health Profiles</a>: Learn about the social, economic and health conditions and outcomes of New Yorkers, neighborhood-by-neighborhood.
                  </li>
                </ul>
                <a href="https://www1.nyc.gov/site/doh/data/data-home.page">Browse all Health Department data resources here</a>.
                </p>
                
            </div>
            
        </article>
        
        <script>
            function printToPage(x) {
                document.getElementById('indName').innerHTML = x.IndicatorName
                document.getElementById('indID').innerHTML = x.IndicatorID
                document.getElementById('indDesc').innerHTML = x.IndicatorDescription
                console.log('printed to page')
            }
            

            
        </script>
        
    {{- end -}}