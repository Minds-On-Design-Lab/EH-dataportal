{{- define "main" -}}

<article class="container-fluid" id="skip-header-target" data-pagefind-ignore="all">

    <div class="col-lg-10 col-md-12 mx-auto my-4">
        <div class="row">
            <div class="col-12">
                <div class="de-accent h1"><i class="fas fa-chart-line mr-1" aria-hidden="true"></i>{{ .Title }}</div>
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-md-7 col-sm-12">
                {{- .Content -}}


                <p class="text-info font-weight-bold">Select a topic to view data:</p>
                {{ partial "de-chooser-accordion.html" . }}


            </div>

            <div class="col-md-5 col-sm-12">

                <div class="card-content mb-4">
                    <img class="card-img-top cardshadow" src="/images/home-sample-image-DE-5.png">
                </div>

                <div class="l-green-border p-1">
                    <!-- Recently updated data -->
                    <p class="home-label"><i class="fas fa-table mr-1" aria-hidden="true"></i>Recently updated datasets:</p>
                    {{ range .Site.Data.recently_updated_data.featured}}
                    <a href="{{ .link }}" class="btn btn-outline-primary mr-1 mb-1 btn-sm">{{ .copy }}</a> 
                    {{ end }}
                </div>

                <div class="l-green-border mt-2 p-1">
                    <!-- Index link -->
                    <p class="fs-sm"><i class="fas fa-exclamation-circle mr-1"></i><em>Can't find what you're looking for?</em> <a class="text-info font-weight-bold" href='{{ ref . "/content/data-explorer/all-data.md" }}'>Browse an index of all our datasets</a>.
                    </p>
                </div>



            </div>
        </div>




    </div>


    <!--
    <div class="col-lg-10 col-sm-12 my-4">

        <div class="row mt-4">
            <div class="col-md-4 card content-card">
                <div class="card-content">
                    <div class="card-body">
                        <img class="card-img-top" src="{{ .Site.BaseURL }}images/trend-chart-4.png" alt="Card image cap">
                    </div>
                    </div>

            </div>

            <div class="col-md-4 card content-card">
                <div class="card-content">
                    <div class="card-body">
                        <img class="card-img-top" src="{{ .Site.BaseURL }}images/data-map-5.png" alt="Card image cap">
                    </div>
                    </div>

            </div>

            <div class="col-md-4 card content-card">
                <div class="card-content">
                    <div class="card-body">
                        <img class="card-img-top" src="{{ .Site.BaseURL }}images/links-chart-4.png" alt="Card image cap">
                    </div>
                    </div>

            </div>

        </div>
    </div>
    -->





    </div>
    
</article>

{{ $js := resources.Get "js/accessible-autocomplete.min.js" -}}
{{ $secureJS := $js | resources.Fingerprint "sha512" }}
<script type="text/javascript" src="{{ $secureJS.RelPermalink }}" integrity="{{ $secureJS.Data.Integrity }}"></script>

<script type="text/javascript"> 

    // https://www.aspsnippets.com/Articles/Populate-DropDownList-from-JSON-Array-using-JavaScript.aspx

    function populateDropDownList() {
        var ddlData = document.getElementById("all-data");
        {{- range .Pages -}} // range through data-explorer pages
        var option = document.createElement("OPTION");
        //Set Neighborhood Name in Text part.
        option.innerHTML = {{ .Title }}
        // set the option value - this adds the environment variable to give it the base URL.
        option.value = '{{ .RelPermalink }}'
        //Add the Option element to DropDownList.
        ddlData && ddlData.options.add(option);
        {{- end -}}
    };
    
    populateDropDownList(); // runs the function above.
    
    // this handles AA highlighting.
    var selectEl = document.querySelector('#all-data')
    accessibleAutocomplete.enhanceSelectElement({
        autoselect: true,
        confirmOnBlur: true,
        defaultValue: "",
        minLength: 2,
        selectElement: selectEl
    });
    
    // this takes the AA form and on submit, sends page to a new location.
    var dataSearchForm = document.getElementById('all-data-select') // this isn't all-data, but all-data-select because of changes applied by the AA JS.
    document.querySelector('form.autocomplete-form').addEventListener("submit", function (e) {
        e.preventDefault(); // prevent page re-load
        window.location.assign(DOMPurify.sanitize(dataSearchForm.options[dataSearchForm.selectedIndex].value))
      });
   </script>

{{- end -}}